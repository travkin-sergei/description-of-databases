{% extends 'base.html' %}
{% block title %}{{ schema_table }} - Детализация таблицы{% endblock %}
{% block body %}
<style>
    .bg-custom-black { background-color: #000000 !important; }
    .btn-custom {
        background-color: #808080 !important;
        border-color: #808080 !important;
        color: white !important;
        transition: all 0.3s ease;
    }
    .btn-custom:hover, .btn-custom:active, .btn-custom:focus {
        background-color: #ff0000 !important;
        border-color: #ff0000 !important;
        box-shadow: 0 0 0 0.25rem rgba(255, 0, 0, 0.25);
    }
    .table-striped-custom tbody tr:nth-child(odd) { background-color: #ffffff !important; }
    .table-striped-custom tbody tr:nth-child(even) { background-color: #ffff99 !important; }
    .environment-badge {
        margin-right: 4px;
        margin-bottom: 4px;
        display: inline-block;
    }
</style>
<h1 class="text-center my-4">Детализация таблицы: {{ schema_table.table.name }}</h1>
<div class="container">
    <div class="card bg-custom-black text-white mb-4">
        <div class="card-body">
            <h5 class="card-title">Информация о таблице</h5>
            <p class="mb-1"><strong>База данных:</strong> {{ schema_table.base_schema.base.name }}</p>
            <p class="mb-1"><strong>Тип базы:</strong> {{ schema_table.base_schema.base.type.name }}</p>
            <p class="mb-1"><strong>Схема:</strong> {{ schema_table.base_schema.schema.name }}</p>
            <p class="mb-1"><strong>Тип таблицы:</strong> {{ schema_table.table_type.name }}</p>
            <p class="mb-0">
                <strong>Статус:</strong>
                <span class="badge bg-{% if schema_table.is_active %}success{% else %}danger{% endif %}">
                    {% if schema_table.is_active %}Активна{% else %}Неактивна{% endif %}
                </span>
            </p>
        </div>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-hover table-striped-custom">
            <thead class="bg-custom-black text-white">
            <tr>
                <th>#</th>
                <th>Имя столбца</th>
                <th>Тип столбца</th>
                <th>Nullable</th>
                <th>Auto</th>
                <th>Описание</th>
                <th>Среды разработки</th>
            </tr>
            </thead>
            <tbody>
            {% for item in column_data %}
            <tr>
                <td>{{ item.column.numbers }}</td>
                <td>{{ item.column.column.name }}</td>
                <td>{{ item.column.column.type.name }}</td>
                <td>
                    <span class="badge bg-{% if item.column.column.is_nullable %}success{% else %}danger{% endif %}">
                        {% if item.column.column.is_nullable %}Да{% else %}Нет{% endif %}
                    </span>
                </td>
                <td>
                    <span class="badge bg-{% if item.column.column.is_auto %}success{% else %}danger{% endif %}">
                        {% if item.column.column.is_auto %}Да{% else %}Нет{% endif %}
                    </span>
                </td>
                <td>{{ item.column.description|default:"-" }}</td>
                <td>
                    {% if item.environments %}
                    {% for env in item.environments %}
                    <span class="badge {% if env.exists %}{{ env.color }}{% else %}bg-white text-dark{% endif %}"
                          title="{{ env.name|default:'Среда отсутствует' }}"
                          style="margin-right: 2px;">
                        {% if env.exists %}
                        {{ env.pk }}
                        {% else %}
                        0
                        {% endif %}
                    </span>
                    {% endfor %}
                    {% else %}
                    <span class="badge bg-white text-dark">0</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-3">
        <a href="{% url 'my_metla:schema-tables' %}" class="btn btn-custom">
            <i class="fas fa-arrow-left"></i> Назад к списку таблиц
        </a>
    </div>
</div>
{% endblock %}